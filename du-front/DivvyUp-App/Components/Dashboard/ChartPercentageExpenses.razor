@using DivvyUp_Shared.Dto
@using DivvyUp_Shared.Interface
@using DivvyUp_Shared.Model

<RadzenStack Style="width: 100%; height: 100%;">
    <RadzenRow>
        <RadzenColumn Size="4">
            <RadzenChart Style="height: 130%">
                <RadzenPieSeries Data="@ChartUnpaidAmount" Title="Aktualny bilans" CategoryProperty="Name" ValueProperty="Value">
                    <RadzenSeriesDataLabels Visible="false" />
                    <RadzenLegend Visible="false" />
                </RadzenPieSeries>
            </RadzenChart>
        </RadzenColumn>
        <RadzenColumn Size="8">
            <RadzenChart Style="height: 130%">
                <RadzenPieSeries Data="@ChartTotalAmount" Title="Łączny wydatek" CategoryProperty="Name" ValueProperty="Value">
                    <RadzenLegend Visible="true" />
                </RadzenPieSeries>
            </RadzenChart>
        </RadzenColumn>
    </RadzenRow>
</RadzenStack>

<style>
    .rz-chart-tooltip{
        z-index: 999 !important;
    }
 </style>

@code {
    [Inject]
    private IPersonService PersonService { get; set; }

    private List<PersonDto> Persons { get; set; }
    private List<PersonChartData> ChartTotalAmount { get; set; }
    private List<PersonChartData> ChartUnpaidAmount { get; set; }

    protected override async Task OnInitializedAsync()
    {
        Persons = await PersonService.GetPersons();
        ChartTotalAmount = Persons.Select(p => new PersonChartData
            {
                Name = p.fullName,
                Value = Math.Round(p.totalAmount, 2)
            }).ToList();

        ChartUnpaidAmount = Persons.Select(p => new PersonChartData
        {
            Name = p.fullName,
            Value = Math.Round(p.unpaidAmount, 2)
        }).ToList();
    }
}
